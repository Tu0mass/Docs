<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON BANDIT: ULTIMATE EDITION</title>
    <style>
        /* --- 1. FONTS & VARIABLES --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&display=swap');

        :root {
            --bg-dark: #050508;
            --panel-bg: #121214;
            --neon-cyan: #00f3ff;
            --neon-magenta: #ff0055;
            --neon-gold: #ffd700;
            --neon-green: #00ff41;
            --glass: rgba(255,255,255,0.03);
            
            --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-elastic: cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            background: #000 radial-gradient(circle at center, #1a1a20 0%, #000 100%);
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            height: 100vh; margin: 0;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }

        /* --- 2. CABINET LAYOUT --- */
        #cabinet {
            position: relative;
            width: 950px; height: 800px;
            background: linear-gradient(180deg, #2b2b30 0%, #050505 100%);
            border: 4px solid #333;
            border-radius: 24px;
            box-shadow: 
                inset 0 0 80px rgba(0,0,0,0.8),
                0 0 60px rgba(0, 243, 255, 0.1);
            display: flex; flex-direction: column;
            padding: 25px;
            transition: all 0.5s ease;
        }

        /* Bonus Mode Visual State */
        #cabinet.mode-bonus {
            border-color: var(--neon-magenta);
            box-shadow: 
                inset 0 0 100px rgba(50,0,0,0.9),
                0 0 80px rgba(255, 0, 85, 0.3);
        }

        /* --- 3. HEADER --- */
        .header-bar {
            height: 70px;
            background: #080808;
            border: 2px solid #222;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px;
            box-shadow: inset 0 0 20px #000;
        }

        .logo { 
            font-family: 'Orbitron'; font-size: 28px; 
            color: var(--neon-cyan); text-shadow: 0 0 15px var(--neon-cyan); 
            letter-spacing: 3px; font-weight: 900;
        }

        .status-panel { font-family: 'Orbitron'; text-align: right; min-width: 200px; }
        .status-main { color: #fff; font-size: 16px; opacity: 0.8; letter-spacing: 1px; }
        .bonus-info { color: var(--neon-magenta); font-weight: bold; display: none; animation: pulseText 1s infinite; }
        #cabinet.mode-bonus .bonus-info { display: block; }
        #cabinet.mode-bonus .status-main { display: none; }

        /* --- 4. REEL SCREEN --- */
        .screen-area {
            flex-grow: 1;
            background: #0a0a0a;
            border: 8px solid #1a1a1a;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 60px #000;
        }

        /* Overlays */
        .scanlines {
            position: absolute; inset: 0; pointer-events: none; z-index: 20; opacity: 0.4;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
        }
        .glass-reflect {
            position: absolute; inset: 0; pointer-events: none; z-index: 21;
            background: linear-gradient(115deg, transparent 35%, rgba(255,255,255,0.05) 40%, transparent 45%);
        }
        .alarm-layer {
            position: absolute; inset: 0; z-index: 1; pointer-events: none; opacity: 0;
            background: radial-gradient(circle, rgba(255,0,85,0.15) 0%, transparent 70%);
            transition: opacity 0.5s;
        }
        #cabinet.mode-bonus .alarm-layer { opacity: 1; animation: alarmPulse 2s infinite; }

        /* Reels */
        .reels-wrapper {
            display: flex; height: 100%; padding: 10px; justify-content: space-between; z-index: 5; position: relative;
        }
        .reel-col {
            width: 19%; height: 100%; position: relative; overflow: hidden;
            background: rgba(255,255,255,0.01); border: 1px solid #222; border-radius: 6px;
        }
        .reel-strip { width: 100%; position: absolute; top: 0; left: 0; will-change: transform; }

        /* Symbols */
        .symbol {
            height: 140px; width: 100%;
            display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .symbol svg { width: 75%; height: 75%; filter: drop-shadow(0 0 5px rgba(255,255,255,0.1)); }
        
        /* Multiplier Badge */
        .mult-badge {
            position: absolute; bottom: 8px; right: 8px;
            background: var(--neon-gold); color: #000;
            font-weight: 900; font-size: 14px; padding: 3px 6px;
            border-radius: 4px; box-shadow: 0 0 10px var(--neon-gold);
            transform: scale(0); transition: transform 0.3s var(--ease-elastic);
        }
        .mult-badge.visible { transform: scale(1); }

        /* --- 5. CONTROL DECK --- */
        .control-deck {
            height: 150px; background: #111; margin-top: 20px; border-top: 1px solid #333;
            border-radius: 0 0 18px 18px; display: grid; grid-template-columns: 1fr 1.2fr 1fr;
            gap: 15px; padding: 15px; z-index: 30;
        }

        .panel-group {
            background: #080808; border: 1px solid #222; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 8px;
        }

        .lbl { font-size: 10px; color: #666; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
        .lcd-display { font-family: 'Orbitron'; color: var(--neon-cyan); font-size: 22px; text-shadow: 0 0 8px rgba(0,243,255,0.2); }

        button { cursor: pointer; border: none; outline: none; transition: 0.15s; }
        
        /* Spin Button */
        .spin-btn {
            width: 90px; height: 90px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #444, #111);
            border: 3px solid var(--neon-green); color: #fff;
            font-family: 'Orbitron'; font-size: 18px; font-weight: 900;
            box-shadow: 0 0 15px var(--neon-green), inset 0 0 10px rgba(0,255,65,0.2);
        }
        .spin-btn:active { transform: scale(0.95); box-shadow: 0 0 5px var(--neon-green); }
        .spin-btn:disabled { filter: grayscale(1) brightness(0.5); cursor: not-allowed; }

        .auto-toggle { 
            margin-top: 8px; background: #222; color: #888; 
            padding: 4px 12px; border-radius: 4px; font-size: 12px; border: 1px solid #444; 
        }
        .auto-toggle.active { background: var(--neon-cyan); color: #000; box-shadow: 0 0 10px var(--neon-cyan); border-color: #fff; }

        /* Bet Controls */
        .bet-row { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
        .adj-btn { width: 30px; height: 30px; background: #333; color: #fff; border-radius: 4px; font-weight: bold; font-size: 18px; }
        .adj-btn:hover { background: #555; }

        /* Buy Bonus */
        .buy-btn {
            width: 100%; padding: 10px; margin-top: 5px;
            background: linear-gradient(135deg, #b8860b 0%, var(--neon-gold) 100%);
            color: #000; font-weight: 900; font-family: 'Orbitron'; border-radius: 6px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); position: relative; overflow: hidden;
        }
        .buy-btn:hover { filter: brightness(1.1); }
        .buy-sub { font-size: 9px; opacity: 0.8; display: block; }
        
        /* --- 6. WIN OVERLAY & PARTICLES --- */
        .win-modal {
            position: absolute; inset: 0; z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .win-modal.active { opacity: 1; pointer-events: auto; }
        
        .win-title {
            font-family: 'Orbitron'; font-size: 70px; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px var(--neon-gold), 0 0 50px var(--neon-magenta);
            transform: scale(0.5); transition: transform 0.5s var(--ease-elastic);
        }
        .win-modal.active .win-title { transform: scale(1); }
        
        .win-amount { font-size: 40px; color: var(--neon-cyan); font-weight: bold; margin-top: 10px; font-family: 'Orbitron'; }

        /* Particles */
        .particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 101; animation: particlePop 1s forwards; }
        @keyframes particlePop {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* Animations */
        @keyframes alarmPulse { 0% {opacity:0.2} 50% {opacity:0.5} 100% {opacity:0.2} }
        @keyframes spinKey { 0% {transform:rotate(0deg)} 100% {transform:rotate(360deg)} }
        @keyframes pulseText { 0% {opacity:0.6} 50% {opacity:1} 100% {opacity:0.6} }

    </style>
</head>
<body>

<div id="cabinet">
    <!-- Header -->
    <div class="header-bar">
        <div class="logo">NEON BANDIT</div>
        <div class="status-panel">
            <span class="status-main" id="msgMain">SYSTEM READY</span>
            <span class="bonus-info" id="msgBonus">FREE SPINS: 0</span>
        </div>
    </div>

    <!-- Screen -->
    <div class="screen-area">
        <div class="scanlines"></div>
        <div class="glass-reflect"></div>
        <div class="alarm-layer"></div>
        
        <div class="reels-wrapper" id="reelsContainer">
            <!-- Reels Injected JS -->
        </div>

        <div class="win-modal" id="winOverlay">
            <div class="win-title" id="winTitle">BIG WIN</div>
            <div class="win-amount" id="winAmount">0</div>
        </div>
    </div>

    <!-- Controls -->
    <div class="control-deck">
        <!-- Bank -->
        <div class="panel-group">
            <span class="lbl">CREDITS</span>
            <div class="lcd-display" id="dispCredits">2000</div>
            <div class="bet-row">
                <button class="adj-btn" onclick="Game.changeBet(-1)">-</button>
                <div class="lcd-display" style="font-size:18px; min-width:40px; text-align:center;" id="dispBet">10</div>
                <button class="adj-btn" onclick="Game.changeBet(1)">+</button>
            </div>
        </div>

        <!-- Spin -->
        <div class="panel-group" style="background:transparent; border:none; justify-content:flex-start;">
            <button class="spin-btn" id="btnSpin" onclick="Game.spin()">SPIN</button>
            <button class="auto-toggle" id="btnAuto" onclick="Game.toggleAuto()">AUTO: OFF</button>
        </div>

        <!-- Features -->
        <div class="panel-group">
            <span class="lbl">LAST WIN</span>
            <div class="lcd-display" id="dispWin">0</div>
            <button class="buy-btn" id="btnBuy" onclick="Game.buyBonus()">
                BUY HEIST
                <span class="buy-sub">COST: 100x</span>
            </button>
        </div>
    </div>
</div>

<script>
/**
 * ===========================================================
 * NEON BANDIT V5.0 - CORE ENGINE
 * ===========================================================
 */

// 1. ASSETS (SVG Strings)
const SVG = {
    wild: `<svg viewBox="0 0 100 100" fill="none" stroke="#00f3ff" stroke-width="4"><path d="M20,30 L80,30 L90,50 L50,90 L10,50 Z" fill="rgba(0,243,255,0.15)"/><path d="M30,45 L40,45 M60,45 L70,45" stroke="#fff" stroke-width="6" stroke-linecap="round"/><text x="50" y="20" text-anchor="middle" fill="#fff" font-size="14" stroke="none" font-family="Orbitron">WILD</text></svg>`,
    scat: `<svg viewBox="0 0 100 100" fill="none" stroke="#ff0055" stroke-width="4"><circle cx="50" cy="50" r="35"/><path d="M50,15 L50,50 L75,75"/><circle cx="50" cy="50" r="5" fill="#ff0055"/><text x="50" y="80" text-anchor="middle" fill="#ff0055" font-size="12" stroke="none" font-family="Orbitron">BONUS</text></svg>`,
    h1:   `<svg viewBox="0 0 100 100" fill="none" stroke="#ffd700" stroke-width="3"><defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ffd700"/><stop offset="100%" stop-color="#b8860b"/></linearGradient></defs><path d="M20,35 L35,20 L65,20 L80,35 L50,85 Z" fill="url(#g1)" opacity="0.8"/><path d="M20,35 L80,35 M35,20 L50,85 L65,20" stroke="#fff" stroke-width="1" opacity="0.6"/></svg>`,
    h2:   `<svg viewBox="0 0 100 100" fill="none" stroke="#00ff41" stroke-width="3"><rect x="25" y="30" width="50" height="40" rx="4" fill="rgba(0,255,65,0.1)"/><text x="50" y="55" text-anchor="middle" fill="#00ff41" font-size="24" stroke="none" font-family="sans-serif">$</text><path d="M15,35 L15,65 M85,35 L85,65" stroke-width="4"/></svg>`,
    m1:   `<svg viewBox="0 0 100 100"><path d="M40,20 L40,70 M50,20 L50,70 M60,20 L60,70" stroke="#ff4500" stroke-width="8"/><rect x="35" y="40" width="30" height="10" fill="#111"/><path d="M50,20 L50,10 L60,5" stroke="#fff" stroke-width="2" fill="none"/></svg>`,
    l1:   `<svg viewBox="0 0 100 100"><text x="50" y="65" text-anchor="middle" font-size="55" fill="#888" stroke="#fff" stroke-width="1" font-family="Orbitron">A</text></svg>`,
    l2:   `<svg viewBox="0 0 100 100"><text x="50" y="65" text-anchor="middle" font-size="55" fill="#666" stroke="#fff" stroke-width="1" font-family="Orbitron">K</text></svg>`,
    l3:   `<svg viewBox="0 0 100 100"><text x="50" y="65" text-anchor="middle" font-size="55" fill="#555" stroke="#fff" stroke-width="1" font-family="Orbitron">Q</text></svg>`,
    l4:   `<svg viewBox="0 0 100 100"><text x="50" y="65" text-anchor="middle" font-size="55" fill="#444" stroke="#fff" stroke-width="1" font-family="Orbitron">J</text></svg>`
};

// 2. CONFIGURATION
const CFG = {
    reels: 5, rows: 3, symH: 140,
    spinTime: 800, delay: 150,
    bets: [10, 20, 50, 100, 200, 500],
    syms: [
        {id:'w', svg:SVG.wild, pay:0, type:'wild'},
        {id:'s', svg:SVG.scat, pay:0, type:'scat'},
        {id:'h1', svg:SVG.h1, pay:50, type:'high'},
        {id:'h2', svg:SVG.h2, pay:30, type:'high'},
        {id:'m1', svg:SVG.m1, pay:20, type:'mid'},
        {id:'l1', svg:SVG.l1, pay:5, type:'low'},
        {id:'l2', svg:SVG.l2, pay:4, type:'low'},
        {id:'l3', svg:SVG.l3, pay:3, type:'low'},
        {id:'l4', svg:SVG.l4, pay:2, type:'low'}
    ],
    weights: [0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 8, 8]
};

// 3. AUDIO (Synthesizer)
const Sfx = {
    ctx: new (window.AudioContext || window.webkitAudioContext)(),
    play(k) {
        if(this.ctx.state==='suspended') this.ctx.resume();
        const t=this.ctx.currentTime, o=this.ctx.createOscillator(), g=this.ctx.createGain();
        o.connect(g); g.connect(this.ctx.destination);
        switch(k) {
            case 'spin':
                o.type='triangle'; o.frequency.setValueAtTime(100,t); o.frequency.linearRampToValueAtTime(300,t+0.2);
                g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.2);
                o.start(t); o.stop(t+0.2); break;
            case 'stop':
                o.type='square'; o.frequency.setValueAtTime(80,t); o.frequency.exponentialRampToValueAtTime(20,t+0.1);
                g.gain.setValueAtTime(0.2,t); g.gain.exponentialRampToValueAtTime(0.01,t+0.15);
                o.start(t); o.stop(t+0.15); break;
            case 'win':
                o.type='sine'; o.frequency.setValueAtTime(400,t); o.frequency.linearRampToValueAtTime(800,t+0.3);
                g.gain.setValueAtTime(0.1,t); g.gain.linearRampToValueAtTime(0,t+0.4);
                o.start(t); o.stop(t+0.4); break;
            case 'bonus':
                o.type='sawtooth'; o.frequency.setValueAtTime(200,t); o.frequency.linearRampToValueAtTime(100,t+1);
                g.gain.setValueAtTime(0.2,t); g.gain.linearRampToValueAtTime(0,t+1);
                o.start(t); o.stop(t+1); break;
        }
    }
};

// 4. GAME LOGIC
const Game = {
    state: 'IDLE', // IDLE, SPINNING, BONUS
    credits: 5000, betIdx: 0, bet: 10, auto: false,
    bonus: { active:false, spins:0, grid:[], win:0 },
    reels: [], // DOM elements

    init() {
        this.buildReels();
        this.updateUI();
    },

    buildReels() {
        const c = document.getElementById('reelsContainer');
        c.innerHTML = ''; this.reels = [];
        for(let i=0; i<CFG.reels; i++) {
            const col = document.createElement('div'); col.className='reel-col';
            const strip = document.createElement('div'); strip.className='reel-strip';
            strip.style.transform = `translateY(-${CFG.symH}px)`; // Hide top buffer
            // Fill initial
            for(let j=0; j<5; j++) strip.appendChild(this.mkSym(this.rndSym()));
            col.appendChild(strip); c.appendChild(col);
            this.reels.push(strip);
        }
    },

    mkSym(d) {
        const el = document.createElement('div'); el.className = 'symbol'; el.innerHTML = d.svg;
        const bdg = document.createElement('div'); bdg.className = 'mult-badge'; el.appendChild(bdg);
        return el;
    },

    rndSym() { return CFG.syms[CFG.weights[Math.floor(Math.random()*CFG.weights.length)]]; },

    changeBet(d) {
        if(this.state!=='IDLE') return;
        this.betIdx = Math.max(0, Math.min(CFG.bets.length-1, this.betIdx+d));
        this.bet = CFG.bets[this.betIdx];
        this.updateUI();
    },

    toggleAuto() {
        this.auto = !this.auto;
        document.getElementById('btnAuto').className = this.auto ? 'auto-toggle active' : 'auto-toggle';
        document.getElementById('btnAuto').textContent = this.auto ? "AUTO: ON" : "AUTO: OFF";
        if(this.auto && this.state==='IDLE') this.spin();
    },

    buyBonus() {
        if(this.state!=='IDLE') return;
        const cost = this.bet * 100;
        if(this.credits >= cost) {
            this.credits -= cost;
            this.updateUI();
            this.spin(true);
        } else { alert("INSUFFICIENT CREDITS"); }
    },

    spin(forceBonus=false) {
        if(this.state==='SPINNING') return;
        
        // Cost
        if(!this.bonus.active && !forceBonus) {
            if(this.credits < this.bet) { this.auto=false; this.updateUI(); alert("NO CREDITS"); return; }
            this.credits -= this.bet;
        }

        this.state = 'SPINNING';
        document.getElementById('winOverlay').className = 'win-modal'; // Hide win
        this.updateUI();
        Sfx.play('spin');

        // Data Gen
        const grid = [];
        for(let i=0; i<CFG.reels; i++) {
            let col = [];
            for(let j=0; j<CFG.rows; j++) col.push(this.rndSym());
            grid.push(col);
        }
        if(forceBonus) {
            const s = CFG.syms.find(x=>x.id==='s');
            grid[0][1]=s; grid[2][1]=s; grid[4][1]=s;
        }

        // Animation
        this.reels.forEach((r, i) => {
            r.style.transition = 'transform 0.2s ease-in';
            r.style.transform = `translateY(100px)`; // Windup
            setTimeout(() => {
                r.style.transition = 'none';
                r.style.transform = `translateY(-1200px)`; // Snap up
                r.innerHTML = ''; // Rebuild
                r.appendChild(this.mkSym(this.rndSym())); // Buffer
                grid[i].forEach(s=>r.appendChild(this.mkSym(s)));
                r.appendChild(this.mkSym(this.rndSym())); // Buffer

                // Land
                setTimeout(() => {
                    r.style.transition = 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
                    r.style.transform = `translateY(-${CFG.symH}px)`;
                    Sfx.play('stop');
                    // Render Multipliers
                    if(this.bonus.active) {
                         for(let row=0; row<3; row++) {
                            let m = this.bonus.grid[i][row];
                            if(m > 1) {
                                let bdg = r.children[row+1].querySelector('.mult-badge');
                                bdg.textContent = 'x'+m; bdg.classList.add('visible');
                            }
                         }
                    }
                }, 50);
            }, CFG.spinTime + (i*CFG.delay));
        });

        // Evaluate
        setTimeout(() => this.evaluate(grid), CFG.spinTime + (CFG.reels*CFG.delay) + 400);
    },

    evaluate(grid) {
        let win = 0, scatters = 0;
        grid.flat().forEach(s => { if(s.id==='s') scatters++; });

        // Line Logic (Any 3+ on rows)
        for(let r=0; r<CFG.rows; r++) {
            let rowSyms = grid.map(c=>c[r]);
            let match=1, first=rowSyms[0], eff=first.id==='w'?null:first.id;
            for(let c=1; c<CFG.reels; c++) {
                let curr=rowSyms[c];
                if(curr.id==='w') match++;
                else if(eff===null) { eff=curr.id; match++; }
                else if(curr.id===eff) match++;
                else break;
            }
            if(match>=3) {
                let sym = eff ? CFG.syms.find(x=>x.id===eff) : CFG.syms[0];
                let base = sym.pay * (match-2) * (this.bet/10);
                if(this.bonus.active) {
                    let mult=1;
                    for(let c=0; c<match; c++) if(this.bonus.grid[c][r]>1) mult+=this.bonus.grid[c][r];
                    base *= mult;
                }
                win += base;
            }
        }

        // Bonus Updates
        if(this.bonus.active) {
            this.bonus.spins--;
            document.getElementById('msgBonus').textContent = "FREE SPINS: "+this.bonus.spins;
            // Increment Multipliers
            for(let c=0; c<5; c++) for(let r=0; r<3; r++) if(grid[c][r].id==='w') this.bonus.grid[c][r]++;
        }

        // Bonus Trigger
        if(scatters>=3) {
            if(!this.bonus.active) {
                this.state = 'IDLE'; // Reset state logic before switch
                this.startBonus(); 
                return;
            } else {
                this.bonus.spins += 2;
                document.getElementById('msgMain').textContent = "RETRIGGER! +2 SPINS";
                Sfx.play('bonus');
            }
        }

        // Payout
        if(win > 0) {
            this.credits += win;
            Sfx.play('win');
            this.showWin(win);
            if(win > this.bet*15) this.spawnParticles();
        }

        // Loop Logic
        this.state = 'IDLE';
        this.updateUI();

        if(this.bonus.active) {
            if(this.bonus.spins > 0) setTimeout(()=>this.spin(), 1200);
            else setTimeout(()=>this.endBonus(), 1500);
        } else if(this.auto && this.credits >= this.bet) {
            setTimeout(()=>this.spin(), 1000);
        } else if(this.auto) {
            this.toggleAuto(); // Stop
        }
    },

    startBonus() {
        this.bonus.active = true;
        this.bonus.spins = 10;
        this.bonus.grid = Array(5).fill().map(()=>[1,1,1]); // 5x3 grid
        document.getElementById('cabinet').classList.add('mode-bonus');
        document.getElementById('msgBonus').textContent = "FREE SPINS: 10";
        Sfx.play('bonus');
        // Start spin loop after delay
        setTimeout(() => this.spin(), 2000);
    },

    endBonus() {
        this.bonus.active = false;
        document.getElementById('cabinet').classList.remove('mode-bonus');
        document.getElementById('msgMain').textContent = "HEIST COMPLETE";
        // Clear Visuals
        document.querySelectorAll('.mult-badge').forEach(b => b.classList.remove('visible'));
        this.state = 'IDLE';
        this.updateUI();
        if(this.auto) setTimeout(()=>this.spin(), 1000);
    },

    showWin(amt) {
        document.getElementById('winTitle').textContent = this.bonus.active ? "HEIST WIN" : (amt>this.bet*20?"BIG WIN":"WINNER");
        document.getElementById('winAmount').textContent = Math.floor(amt);
        document.getElementById('winOverlay').className = 'win-modal active';
        document.getElementById('dispWin').textContent = Math.floor(amt);
        setTimeout(() => document.getElementById('winOverlay').className = 'win-modal', 2000);
    },

    updateUI() {
        document.getElementById('dispCredits').textContent = Math.floor(this.credits);
        document.getElementById('dispBet').textContent = this.bet;
        const btnSpin = document.getElementById('btnSpin');
        btnSpin.disabled = (this.state==='SPINNING');
        const buyCost = this.bet*100;
        document.getElementById('btnBuy').style.opacity = (this.credits>=buyCost && this.state==='IDLE') ? '1':'0.5';
    },

    spawnParticles() {
        for(let i=0; i<30; i++) {
            const p = document.createElement('div'); p.className='particle';
            p.style.width = p.style.height = (Math.random()*10+5)+'px';
            p.style.background = `hsl(${Math.random()*60+40}, 100%, 50%)`;
            p.style.left='50%'; p.style.top='50%';
            const angle = Math.random()*Math.PI*2, dist = Math.random()*300+100;
            p.style.setProperty('--tx', Math.cos(angle)*dist+'px');
            p.style.setProperty('--ty', Math.sin(angle)*dist+'px');
            document.body.appendChild(p);
            setTimeout(()=>p.remove(), 1000);
        }
    }
};

window.onload = () => Game.init();
</script>
</body>
</html>