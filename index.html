<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE NEON BANDIT v2.0 - Feature Buy</title>
    <style>
        /* --- FONTS & VARS --- */
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&family=Share+Tech+Mono&display=swap');

        :root {
            --bg-dark: #05020a;
            --metal-dark: #151515;
            --metal-mid: #2a2a2a;
            --neon-cyan: #00F3FF;
            --neon-magenta: #FF0055;
            --neon-gold: #FFD700;
            --neon-green: #00FF41;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body {
            background-color: #000;
            background-image: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%; /* CRT Scanline effect */
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* --- CABINET --- */
        .cabinet {
            position: relative;
            width: 900px;
            height: 700px; /* Taller for controls */
            background: linear-gradient(180deg, #333, #111);
            border-radius: 25px;
            box-shadow: 
                0 0 80px rgba(0, 243, 255, 0.15),
                inset 0 0 30px rgba(0,0,0,0.9),
                0 20px 50px #000;
            border: 4px solid #444;
            display: flex;
            flex-direction: column;
            padding: 25px;
            z-index: 1;
        }

        /* --- MARQUEE --- */
        .marquee {
            height: 60px;
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 20px rgba(0, 243, 255, 0.1);
        }

        .bandit-eyes {
            font-size: 32px;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
            letter-spacing: 5px;
            font-family: 'Share Tech Mono';
        }

        /* --- REELS --- */
        .vault-frame {
            flex-grow: 1;
            background: #080808;
            border: 5px solid #222;
            border-radius: 10px;
            position: relative;
            display: flex;
            padding: 10px;
            box-shadow: inset 0 0 50px #000;
            overflow: hidden;
        }

        /* Glass Reflection Overlay */
        .glass-glare {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(115deg, transparent 40%, rgba(255,255,255,0.05) 45%, transparent 50%);
            pointer-events: none;
            z-index: 20;
        }

        .reels-container {
            display: flex;
            gap: 8px;
            width: 100%;
            z-index: 5;
        }

        .reel-strip {
            flex: 1;
            background: linear-gradient(180deg, #000 0%, #1a1a25 50%, #000 100%);
            border: 1px solid #333;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .reel-content {
            display: flex;
            flex-direction: column;
            /* Center the initial strip */
            transform: translateY(0); 
        }

        .symbol {
            height: 110px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 55px;
            position: relative;
        }

        /* Symbol Glows */
        .symbol[data-type="high"] { text-shadow: 0 0 15px rgba(255,215,0,0.5); }
        .symbol[data-type="scat"] { text-shadow: 0 0 20px var(--neon-magenta); }
        .symbol[data-type="wild"] { filter: drop-shadow(0 0 8px var(--neon-cyan)); }

        /* Animations */
        .spinning .reel-content {
            animation: spinBlur 0.15s infinite linear;
        }
        @keyframes spinBlur {
            0% { filter: blur(2px); transform: translateY(-50px); }
            100% { filter: blur(8px); transform: translateY(50px); }
        }

        .bounce { animation: bounceStop 0.3s cubic-bezier(0.2, 0.8, 0.3, 1); }
        @keyframes bounceStop {
            0% { transform: translateY(-30px); }
            50% { transform: translateY(10px); }
            100% { transform: translateY(0); }
        }

        .winner {
            z-index: 10;
            animation: pulseWin 0.8s infinite alternate;
        }
        @keyframes pulseWin {
            0% { transform: scale(1); filter: brightness(1); }
            100% { transform: scale(1.15); filter: brightness(1.5) drop-shadow(0 0 10px var(--neon-gold)); }
        }

        /* --- DASHBOARD --- */
        .dashboard {
            height: 140px;
            margin-top: 15px;
            background: #111;
            border-top: 2px solid #444;
            border-radius: 0 0 15px 15px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 15px;
            position: relative;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 5px;
        }

        .screen-text {
            font-family: 'Share Tech Mono';
            color: var(--neon-cyan);
            font-size: 20px;
            margin-bottom: 5px;
            text-shadow: 0 0 5px rgba(0, 243, 255, 0.3);
        }

        .label { font-size: 10px; color: #555; letter-spacing: 1px; text-transform: uppercase; }

        /* Buttons */
        .btn-row { display: flex; gap: 10px; align-items: center; }
        
        button {
            cursor: pointer;
            font-family: 'Rajdhani';
            font-weight: 700;
            text-transform: uppercase;
            transition: all 0.1s;
            border: none;
            outline: none;
        }

        .adj-btn {
            width: 30px; height: 30px;
            background: #333; color: #fff;
            border-radius: 4px;
            font-size: 18px;
            box-shadow: 0 3px 0 #111;
        }
        .adj-btn:active { transform: translateY(3px); box-shadow: none; }

        .spin-btn {
            width: 90px; height: 90px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #555, #000);
            border: 3px solid var(--neon-green);
            color: #fff; font-size: 18px;
            box-shadow: 0 0 15px var(--neon-green), inset 0 0 10px rgba(0,255,65,0.3);
        }
        .spin-btn:active { transform: scale(0.95); }
        .spin-btn.auto-active {
            background: radial-gradient(circle at 30% 30%, #500, #200);
            border-color: #f00;
            box-shadow: 0 0 15px #f00;
            animation: heartbeat 1s infinite;
        }
        @keyframes heartbeat { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        .buy-btn {
            background: linear-gradient(45deg, #8a6400, #ffd700);
            color: #000;
            width: 100%; padding: 8px 0;
            margin-top: 5px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 900;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
        }
        .buy-btn::after {
            content: ''; position: absolute; top:0; left:-100%; width:100%; height:100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: shine 3s infinite;
        }
        @keyframes shine { 0% {left:-100%} 20% {left:100%} 100% {left:100%} }

        .auto-btn {
            background: #222; color: #fff;
            padding: 5px 15px; border-radius: 4px;
            border: 1px solid #444;
            font-size: 12px; margin-top: 5px;
        }
        .auto-btn.on { background: var(--neon-cyan); color: #000; box-shadow: 0 0 8px var(--neon-cyan); }

        /* --- OVERLAYS --- */
        .win-overlay {
            position: absolute; top: 40%; left: 50%;
            transform: translate(-50%, -50%) scale(0);
            text-align: center;
            pointer-events: none;
            z-index: 100;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .win-text-main {
            font-size: 80px; font-weight: 900; color: #fff;
            text-shadow: 0 0 20px var(--neon-gold), 0 0 40px var(--neon-magenta);
            line-height: 0.9;
        }
        .win-text-sub { font-size: 40px; color: var(--neon-cyan); font-family: 'Share Tech Mono'; }
        .active-win { transform: translate(-50%, -50%) scale(1); }

    </style>
</head>
<body>

    <div class="cabinet">
        
        <!-- Header -->
        <div class="marquee">
            <div class="bandit-eyes" id="banditHeader">NEON BANDIT // SYSTEM READY</div>
        </div>

        <!-- Reels -->
        <div class="vault-frame">
            <div class="glass-glare"></div>
            <div class="reels-container" id="reelsContainer">
                <!-- Generated JS -->
            </div>
            
            <div class="win-overlay" id="winOverlay">
                <div class="win-text-main" id="winTitle">BIG WIN</div>
                <div class="win-text-sub" id="winAmount">0</div>
            </div>
        </div>

        <!-- Controls -->
        <div class="dashboard">
            
            <!-- Left: Balance & Bet -->
            <div class="control-group">
                <span class="label">CREDITS</span>
                <div class="screen-text" id="creditsDisplay">2000</div>
                
                <span class="label" style="margin-top:5px;">BET AMOUNT</span>
                <div class="btn-row">
                    <button class="adj-btn" onclick="changeBet(-1)">-</button>
                    <div class="screen-text" id="betDisplay" style="font-size:18px; min-width:40px; text-align:center;">10</div>
                    <button class="adj-btn" onclick="changeBet(1)">+</button>
                </div>
            </div>

            <!-- Center: Spin -->
            <div class="control-group" style="border:none; background:none;">
                <button class="spin-btn" id="spinBtn">SPIN</button>
                <button class="auto-btn" id="autoBtn" onclick="toggleAutoSpin()">AUTO: OFF</button>
            </div>

            <!-- Right: Wins & Feature -->
            <div class="control-group">
                <span class="label">LAST WIN</span>
                <div class="screen-text" id="lastWinDisplay">0</div>
                
                <button class="buy-btn" id="buyBtn" onclick="buyBonus()">
                    BUY BONUS <br> <span style="font-size:10px; opacity:0.8;">(COST: 100x)</span>
                </button>
            </div>

        </div>
    </div>

    <script>
        /* --- CONFIG & ASSETS --- */
        const CONFIG = {
            reels: 5,
            rows: 3,
            symbolHeight: 110,
            spinTime: 1000, // Base spin time
            reelDelay: 200,
            betLevels: [10, 20, 50, 100, 200]
        };

        const SYMBOLS = [
            { id: 'wild',  val: 'ðŸ¦', type: 'wild',  pay: 0 }, 
            { id: 'scat',  val: 'â˜¢ï¸', type: 'scat',  pay: 0 },
            { id: 'high1', val: 'ðŸ’Ž', type: 'high',  pay: 50 },
            { id: 'high2', val: 'ðŸ’°', type: 'high',  pay: 30 },
            { id: 'mid1',  val: 'ðŸ’£', type: 'mid',   pay: 15 },
            { id: 'mid2',  val: 'ðŸ”«', type: 'mid',   pay: 10 },
            { id: 'low1',  val: 'A',  type: 'low',   pay: 5 },
            { id: 'low2',  val: 'K',  type: 'low',   pay: 4 },
            { id: 'low3',  val: 'Q',  type: 'low',   pay: 3 },
            { id: 'low4',  val: 'J',  type: 'low',   pay: 2 }
        ];

        // Simple weighted RNG
        const WEIGHTS = [
            0, 1, // Rare
            2, 2, 3, 3, 4, 4, // High/Mid
            5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 9 // Lows
        ];

        /* --- STATE --- */
        let state = {
            credits: 2000,
            betIndex: 0,
            isSpinning: false,
            autoSpin: false,
            reels: [], // DOM elements
            grid: []   // Result logic
        };

        /* --- AUDIO ENGINE --- */
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();

        function tone(freq, type, dur, vol=0.1) {
            if(ctx.state === 'suspended') ctx.resume();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, ctx.currentTime);
            gain.gain.setValueAtTime(vol, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + dur);
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + dur);
        }

        function playSfx(name) {
            switch(name) {
                case 'spin': tone(150, 'sawtooth', 0.1); break;
                case 'stop': tone(80, 'square', 0.1, 0.2); break;
                case 'win': 
                    setTimeout(()=>tone(400,'sine',0.1),0);
                    setTimeout(()=>tone(500,'sine',0.1),100);
                    setTimeout(()=>tone(800,'sine',0.4),200);
                    break;
                case 'bonus':
                    tone(100, 'sawtooth', 1.0, 0.3);
                    tone(50, 'square', 1.0, 0.3);
                    break;
            }
        }

        /* --- CORE FUNCTIONS --- */
        
        function init() {
            const container = document.getElementById('reelsContainer');
            
            // Build Reels
            for(let i=0; i<CONFIG.reels; i++) {
                const strip = document.createElement('div');
                strip.className = 'reel-strip';
                const content = document.createElement('div');
                content.className = 'reel-content';
                // Set initial offset
                content.style.marginTop = `-${CONFIG.symbolHeight}px`;
                
                // Fill initial dummy symbols
                for(let j=0; j<5; j++) {
                    content.appendChild(createSymbol(getRandomSymbol()));
                }
                
                strip.appendChild(content);
                container.appendChild(strip);
                state.reels.push({ strip, content });
            }

            document.getElementById('spinBtn').addEventListener('click', () => triggerSpin(false));
            updateUI();
        }

        function createSymbol(symData) {
            const el = document.createElement('div');
            el.className = 'symbol';
            el.textContent = symData.val;
            el.dataset.type = symData.type;
            el.dataset.id = symData.id;
            return el;
        }

        function getRandomSymbol() {
            const idx = WEIGHTS[Math.floor(Math.random() * WEIGHTS.length)];
            return SYMBOLS[idx];
        }

        /* --- BETTING SYSTEM --- */
        function changeBet(dir) {
            if(state.isSpinning) return;
            state.betIndex += dir;
            if(state.betIndex < 0) state.betIndex = 0;
            if(state.betIndex >= CONFIG.betLevels.length) state.betIndex = CONFIG.betLevels.length - 1;
            updateUI();
        }

        function getCurrentBet() {
            return CONFIG.betLevels[state.betIndex];
        }

        /* --- AUTOSPIN --- */
        function toggleAutoSpin() {
            state.autoSpin = !state.autoSpin;
            const btn = document.getElementById('autoBtn');
            if(state.autoSpin) {
                btn.classList.add('on');
                btn.innerText = "AUTO: ON";
                if(!state.isSpinning) triggerSpin(false);
            } else {
                btn.classList.remove('on');
                btn.innerText = "AUTO: OFF";
            }
        }

        /* --- BUY BONUS --- */
        function buyBonus() {
            if(state.isSpinning) return;
            const cost = getCurrentBet() * 100;
            
            if(state.credits >= cost) {
                // Turn off auto spin if buying feature
                if(state.autoSpin) toggleAutoSpin();
                
                state.credits -= cost; // Deduct cost manually
                updateUI();
                triggerSpin(true); // Force bonus flag
            } else {
                alert("INSUFFICIENT CREDITS FOR HEIST!");
            }
        }

        /* --- SPIN LOGIC --- */
        function triggerSpin(forceBonus = false) {
            const bet = getCurrentBet();
            if(state.isSpinning) return;
            
            // Check Balance (unless forceBonus already deducted)
            if(!forceBonus) {
                if(state.credits < bet) {
                    state.autoSpin = false;
                    updateUI();
                    alert("INSERT COIN");
                    return;
                }
                state.credits -= bet;
            }

            state.isSpinning = true;
            
            // Visual reset
            document.getElementById('winOverlay').classList.remove('active-win');
            document.getElementById('banditHeader').innerText = "ACCESSING VAULT...";
            document.getElementById('banditHeader').style.color = "#00F3FF";
            
            state.reels.forEach(r => {
                r.strip.classList.add('spinning');
                r.content.querySelectorAll('.symbol').forEach(s => s.classList.remove('winner'));
            });
            updateUI();
            playSfx('spin');

            // Generate Grid
            state.grid = [];
            for(let c=0; c<CONFIG.reels; c++) {
                let col = [];
                for(let r=0; r<CONFIG.rows; r++) col.push(getRandomSymbol());
                state.grid.push(col);
            }

            // RIGGING: If Buy Bonus, inject Scatters
            if(forceBonus) {
                // Scatters on Reel 1, 3, 5 (Indices 0, 2, 4)
                state.grid[0][1] = SYMBOLS.find(s => s.id === 'scat');
                state.grid[2][1] = SYMBOLS.find(s => s.id === 'scat');
                state.grid[4][1] = SYMBOLS.find(s => s.id === 'scat');
                playSfx('bonus');
            }

            // Stop Sequence
            state.reels.forEach((reel, i) => {
                setTimeout(() => {
                    stopReel(i, state.grid[i]);
                }, CONFIG.spinTime + (i * CONFIG.reelDelay));
            });

            // End of Spin Handler
            setTimeout(() => {
                state.isSpinning = false;
                evaluateWin();
                
                // Handle Auto Spin Loop
                if(state.autoSpin && state.credits >= bet) {
                    setTimeout(() => triggerSpin(false), 1000);
                } else if(state.autoSpin && state.credits < bet) {
                    toggleAutoSpin(); // Stop if no money
                }

            }, CONFIG.spinTime + (CONFIG.reels * CONFIG.reelDelay) + 500);
        }

        function stopReel(index, symbols) {
            const reel = state.reels[index];
            const content = reel.content;
            
            reel.strip.classList.remove('spinning');
            playSfx('stop');
            
            // Rebuild DOM: Buffer + Result + Buffer
            content.innerHTML = '';
            content.appendChild(createSymbol(getRandomSymbol())); // Buffer Top
            symbols.forEach(s => content.appendChild(createSymbol(s))); // Result
            content.appendChild(createSymbol(getRandomSymbol())); // Buffer Bot
            
            // Bounce Effect
            content.classList.add('bounce');
            setTimeout(()=>content.classList.remove('bounce'), 300);
        }

        /* --- WIN LOGIC --- */
        function evaluateWin() {
            const grid = state.grid;
            let totalWin = 0;
            let winLines = [];
            const currentBet = getCurrentBet();

            // 1. Check Line Wins (Simple: 3+ matching on Middle Row)
            // Index 1 is middle row
            let middleRow = grid.map(col => col[1]);
            let matchCount = 1;
            let firstSym = middleRow[0];
            let isWild = firstSym.id === 'wild';
            let effectiveId = firstSym.id;

            // Look at first symbol to determine line type
            if(isWild && middleRow[1]) {
                 effectiveId = middleRow[1].id; // Wild adopts next symbol
            }
            
            // Determine match length
            for(let i=1; i<middleRow.length; i++) {
                let s = middleRow[i];
                // Match if IDs match OR symbol is wild OR prev was wild (and we now lock ID)
                if(s.id === effectiveId || s.id === 'wild') {
                    matchCount++;
                } else if (effectiveId === 'wild') {
                    // We started with wild, now we found a real symbol, this is the target
                    effectiveId = s.id;
                    matchCount++;
                } else {
                    break;
                }
            }

            if(matchCount >= 3) {
                let symObj = SYMBOLS.find(s => s.id === effectiveId);
                if(!symObj && effectiveId === 'wild') symObj = SYMBOLS[0]; // 5 wilds
                
                let payout = symObj ? symObj.pay : 0;
                // Payout formula
                let winAmt = payout * (matchCount - 2) * (currentBet / 10);
                if(winAmt > 0) {
                    totalWin += Math.floor(winAmt);
                    // Highlight Middle Row
                    for(let i=0; i<matchCount; i++) {
                        // Access DOM: content -> children[1] (middle row)
                        state.reels[i].content.children[2].classList.add('winner');
                    }
                }
            }

            // 2. Check Scatters (Anywhere)
            let scatterCount = 0;
            grid.flat().forEach(s => { if(s.id === 'scat') scatterCount++; });
            
            if(scatterCount >= 3) {
                // Bonus Trigger
                totalWin += currentBet * 10; // Instant prize
                document.getElementById('banditHeader').innerText = "!!! HEIST TRIGGERED !!!";
                document.getElementById('banditHeader').style.color = "#FF0055";
                playSfx('bonus');
                // Stop autospin on bonus
                if(state.autoSpin) toggleAutoSpin();
                
                // Highlight Scatters
                state.reels.forEach(r => {
                    Array.from(r.content.children).forEach(child => {
                        if(child.dataset.id === 'scat') child.classList.add('winner');
                    });
                });
            }

            // 3. Handle Payout
            if(totalWin > 0) {
                state.credits += totalWin;
                playSfx('win');
                document.getElementById('lastWinDisplay').innerText = totalWin;
                document.getElementById('winAmount').innerText = totalWin;
                document.getElementById('winTitle').innerText = scatterCount >= 3 ? "HEIST BONUS" : "BIG WIN";
                
                document.getElementById('winOverlay').classList.add('active-win');
            }

            updateUI();
        }

        function updateUI() {
            document.getElementById('creditsDisplay').innerText = Math.floor(state.credits);
            document.getElementById('betDisplay').innerText = getCurrentBet();
            
            // Dim Buy Button if too expensive
            const buyCost = getCurrentBet() * 100;
            const buyBtn = document.getElementById('buyBtn');
            if(state.credits < buyCost) {
                buyBtn.style.opacity = "0.5";
                buyBtn.style.cursor = "not-allowed";
            } else {
                buyBtn.style.opacity = "1";
                buyBtn.style.cursor = "pointer";
            }
        }

        // Start
        init();

    </script>
</body>
</html>